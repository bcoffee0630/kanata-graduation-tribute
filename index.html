<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="天音かなた卒業記念サイト | Amane Kanata Memorial Website">

    <!-- Open Graph -->
    <meta property="og:title" content="天音かなた卒業記念 | Amane Kanata Memorial">
    <meta property="og:description" content="Forever Kanata - 永遠にかなた">
    <meta property="og:image" content="images/kanata-graduation-live.png">
    <meta property="og:url" content="https://bcoffee0630.github.io/kanata-graduation-tribute/">

    <title>天音かなた 卒業メモリアル</title>

    <link rel="icon" type="image/png" href="shooting-star.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/gallery.css">
    <link rel="stylesheet" href="assets/css/danmaku.css">
    <link rel="stylesheet" href="assets/css/modal.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;500;700&family=Noto+Sans+JP:wght@300;400;700&family=Noto+Sans+TC:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 統一導航欄 - Unified Navigation Bar -->
    <nav class="site-nav">
        <!-- 左側：漢堡按鈕 (手機版) + 導航連結 (桌面版) -->
        <div class="nav-left">
            <!-- Mobile: Hamburger Button -->
            <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                <span class="hamburger"></span>
            </button>
            <!-- Desktop: Nav Links -->
            <ul class="nav-links">
                <li><a href="#intro" data-i18n="nav.home">ホーム</a></li>
                <li><a href="#danmaku-section" data-i18n="nav.messages">メッセージ</a></li>
                <li><a href="#gallery-section" data-i18n="nav.gallery">ギャラリー</a></li>
                <li><a href="https://www.youtube.com/channel/UCZlDXzGoo7d44bwdNObFacg" target="_blank" data-i18n="nav.youtube">YouTube</a></li>
                <li><a href="https://x.com/amanekanatach" target="_blank" data-i18n="nav.twitter">Twitter</a></li>
            </ul>
        </div>

        <!-- 右側：帳號 + 語言 -->
        <div class="nav-right">
            <!-- Auth Container -->
            <div class="auth-container">
                <!-- Login Buttons (GitHub + Google) -->
                <div id="login-buttons" class="login-buttons">
                    <button id="login-github" class="login-btn login-btn-github">
                        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                        <span>GitHub</span>
                    </button>
                    <button id="login-google" class="login-btn login-btn-google">
                        <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        <span>Google</span>
                    </button>
                </div>
                <!-- User Display (shown when logged in) -->
                <div id="user-display">
                    <button class="user-trigger" aria-expanded="false" aria-haspopup="true">
                        <img class="user-avatar" src="" alt="">
                        <span class="user-name"></span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="user-dropdown">
                        <span class="user-provider"></span>
                        <div class="dropdown-divider"></div>
                        <button id="logout-button" data-i18n="auth.logout">ログアウト</button>
                    </div>
                </div>
            </div>

            <!-- Language Switcher (Unified Dropdown) -->
            <div class="lang-switcher">
                <button type="button" class="lang-current" aria-expanded="false" aria-haspopup="true">
                    <span class="lang-current-text">JP</span>
                    <span class="lang-arrow">▼</span>
                </button>
                <div class="lang-menu">
                    <button type="button" class="lang-option" data-lang="ja">JP - 日本語</button>
                    <button type="button" class="lang-option" data-lang="zh-TW">TW - 繁體中文</button>
                    <button type="button" class="lang-option" data-lang="en">EN - English</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 手機版導航選單 (從 nav bar 下滑出) -->
    <div class="mobile-nav">
        <ul class="nav-links">
            <li><a href="#intro" data-i18n="nav.home">ホーム</a></li>
            <li><a href="#danmaku-section" data-i18n="nav.messages">メッセージ</a></li>
            <li><a href="#gallery-section" data-i18n="nav.gallery">ギャラリー</a></li>
            <li><a href="https://www.youtube.com/channel/UCZlDXzGoo7d44bwdNObFacg" target="_blank" data-i18n="nav.youtube">YouTube</a></li>
            <li><a href="https://x.com/amanekanatach" target="_blank" data-i18n="nav.twitter">Twitter</a></li>
        </ul>
    </div>

    <!-- Spacer for fixed navbar -->
    <div class="nav-spacer"></div>

    <!-- 主要 Header -->
    <header class="main-header">
        <div class="header-bg"></div>
        <div class="header-content">
            <h1 data-i18n="header_title">天音かなた 卒業記念</h1>
            <div class="counter-container">
                <p class="counter-prefix" data-i18n="day_counter_prefix">卒業日 2025/12/27 から</p>
                <h2 class="counter-number">
                    <span id="day-counter-number">0</span>
                    <span class="counter-unit" data-i18n="day_counter_unit">日</span>
                </h2>
            </div>
        </div>
    </header>

    <!-- 主要內容 -->
    <main>
        <!-- 紀念介紹區塊 -->
        <section id="intro" class="content-section intro-section reveal-on-scroll">
            <div class="container">
                <h2 data-i18n="sections.intro_title">永遠に、かなたと共に</h2>
                <p data-i18n="sections.intro_text">
                    このサイトは、天音かなたさんの思い出を共有し、彼女と過ごした時間を永遠に記憶するためのファンメモリアルです。かなたんが残してくれた歌声、笑顔、そして数え切れない思い出は、私たちの心の中で生き続けます。
                </p>
            </div>
        </section>

        <!-- 彈幕留言區 -->
        <section id="danmaku-section" class="danmaku-section reveal-on-scroll">
            <h2 data-i18n="sections.fan_messages">ファンからのメッセージ</h2>
            <div id="danmaku-container"></div>
            <div id="danmaku-controls">
                <button class="danmaku-play-pause" data-i18n="danmaku.pause">⏸</button>
            </div>
            <div class="danmaku-contribute">
                <p data-i18n="sections.contribute_message">メッセージを追加したい方は、下のボタンをクリックしてください。</p>
                <button id="submit-message-btn" class="submit-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                    <span data-i18n="sections.submit_message_button">メッセージを投稿</span>
                </button>
                <div class="login-prompt">
                    <p data-i18n="auth.login_to_submit">投稿するにはログインしてください</p>
                </div>
            </div>
        </section>

        <!-- 粉絲畫廊區 -->
        <section id="gallery-section" class="gallery-section reveal-on-scroll">
            <div class="container">
                <h2 data-i18n="sections.gallery_title">ファンアートギャラリー</h2>
                <div id="gallery-grid"></div>
                <button id="load-more-btn" class="load-more-btn" style="display: none;" data-i18n="gallery.load_more">もっと見る</button>
                <div class="gallery-contribute">
                    <p data-i18n="sections.contribute_art">イラストを投稿したい方は、下のボタンをクリックしてください。</p>
                    <button id="submit-fanart-btn" class="submit-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                        <span data-i18n="sections.submit_art_button">イラストを投稿</span>
                    </button>
                    <div class="login-prompt">
                        <p data-i18n="auth.login_to_submit">投稿するにはログインしてください</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close">&times;</button>
            <button class="lightbox-nav lightbox-prev">&#10094;</button>
            <button class="lightbox-nav lightbox-next">&#10095;</button>
            <div class="lightbox-image"></div>
            <div class="lightbox-info"></div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="message-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.message_title">メッセージを投稿</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="message-form">
                    <div class="form-group">
                        <label for="message-content" data-i18n="modal.message">メッセージ</label>
                        <textarea id="message-content" maxlength="500" required placeholder=""></textarea>
                        <div id="char-count">0/500</div>
                    </div>
                    <div class="submit-confirmation">
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_appropriate">不当な発言や差別的な内容を含んでいません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_political">政治的に敏感な内容を含んでいません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_copyright">他者の著作権を侵害していません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_guidelines">コミュニティガイドラインに同意します</span>
                        </label>
                    </div>
                    <button type="submit" class="submit-form-btn" disabled data-i18n="modal.submit">送信</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Fanart Modal -->
    <div id="fanart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.fanart_title">イラストを投稿</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="fanart-form">
                    <div class="form-group">
                        <div class="upload-area">
                            <input type="file" id="fanart-image" accept="image/png,image/jpeg" required>
                            <label for="fanart-image">
                                <div class="upload-icon">📷</div>
                                <div class="upload-text" data-i18n="modal.upload_image">画像をアップロード</div>
                                <div class="upload-hint">PNG, JPG (10MB以下)</div>
                            </label>
                        </div>
                        <div id="image-preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="fanart-caption" data-i18n="modal.caption">キャプション</label>
                        <input type="text" id="fanart-caption" data-i18n-placeholder="modal.caption_placeholder" placeholder="任意">
                    </div>
                    <div class="form-group">
                        <label for="artist-link" data-i18n="modal.artist_link">SNSリンク (任意)</label>
                        <input type="url" id="artist-link" placeholder="https://twitter.com/...">
                        <small data-i18n="modal.artist_link_hint">Twitter, Pixiv, etc.</small>
                    </div>
                    <div class="submit-confirmation">
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_appropriate">不当な発言や差別的な内容を含んでいません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_political">政治的に敏感な内容を含んでいません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_copyright">他者の著作権を侵害していません</span>
                        </label>
                        <label class="confirm-label">
                            <input type="checkbox" class="confirm-checkbox" required>
                            <span data-i18n="modal.confirm_guidelines">コミュニティガイドラインに同意します</span>
                        </label>
                    </div>
                    <button type="submit" class="submit-form-btn" disabled data-i18n="modal.submit">送信</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p class="forever-kanata" data-i18n="footer.forever_kanata">永遠にかなた</p>
            <div class="credits">
                <p data-i18n="footer.credits_title">Credits:</p>
                <ul>
                    <li>Header: <a href="https://www.youtube.com/watch?v=IdXhY6zGC4s" target="_blank">誰も見てない夢を見ろ - 天音かなた</a></li>
                    <li>Background: <a href="https://www.youtube.com/watch?v=8iGGL_0CEpc" target="_blank">天音かなた卒業ライブ</a></li>
                    <li><a href="https://www.flaticon.com/free-icons/star" title="star icons" target="_blank">Star icons created by Freepik - Flaticon</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>

    <!-- Core Scripts -->
    <script src="assets/js/i18n.js"></script>
    <script src="assets/js/counter.js"></script>

    <!-- Firebase Integration -->
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/firebase-init.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/submit.js"></script>
    <script src="assets/js/report.js"></script>

    <!-- Features -->
    <script src="assets/js/gallery.js"></script>
    <script src="assets/js/danmaku.js"></script>
    <script src="assets/js/effects.js"></script>
    <script src="assets/js/animations.js"></script>

    <!-- Mobile Navigation & Language Dropdown -->
    <script>
    (function() {
        // ==================== Navbar Scroll Behavior ====================
        const siteNav = document.querySelector('.site-nav');
        let lastScrollY = 0;
        let ticking = false;
        const scrollThreshold = 10; // Minimum scroll delta to trigger hide/show

        function updateNavbar() {
            const currentScrollY = window.scrollY;

            // Always show navbar at top of page
            if (currentScrollY <= 0) {
                siteNav.classList.remove('nav-hidden');
                lastScrollY = currentScrollY;
                ticking = false;
                return;
            }

            // Don't hide when mobile nav is open
            if (document.body.classList.contains('nav-open')) {
                ticking = false;
                return;
            }

            const scrollDelta = currentScrollY - lastScrollY;

            // Scrolling down - hide navbar
            if (scrollDelta > scrollThreshold) {
                siteNav.classList.add('nav-hidden');
                lastScrollY = currentScrollY;
            }
            // Scrolling up - show navbar
            else if (scrollDelta < -scrollThreshold) {
                siteNav.classList.remove('nav-hidden');
                lastScrollY = currentScrollY;
            }

            ticking = false;
        }

        window.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(updateNavbar);
                ticking = true;
            }
        }, { passive: true });

        // ==================== Mobile Navigation ====================
        const navToggle = document.querySelector('.nav-toggle');
        const mobileNav = document.querySelector('.mobile-nav');

        if (navToggle && mobileNav) {
            // Toggle menu on button click
            navToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = mobileNav.classList.toggle('open');
                navToggle.classList.toggle('active');
                navToggle.setAttribute('aria-expanded', isOpen);
                // Lock body scroll and fix nav bar position when menu is open
                document.body.classList.toggle('nav-open', isOpen);
                // Close language dropdown when opening nav
                closeLangDropdown();
            });

            // Close menu when clicking a nav link
            mobileNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileNav.classList.remove('open');
                    navToggle.classList.remove('active');
                    navToggle.setAttribute('aria-expanded', 'false');
                    document.body.classList.remove('nav-open');
                });
            });
        }

        // ==================== Language Dropdown (Unified) ====================
        const langSwitcher = document.querySelector('.lang-switcher');
        const langCurrent = document.querySelector('.lang-current');
        const langCurrentText = document.querySelector('.lang-current-text');
        const langOptions = document.querySelectorAll('.lang-option');

        const langNames = { 'ja': 'JP', 'zh-TW': 'TW', 'en': 'EN' };

        function closeLangDropdown() {
            if (langSwitcher) {
                langSwitcher.classList.remove('open');
                langCurrent?.setAttribute('aria-expanded', 'false');
            }
        }

        function closeNavMenu() {
            if (mobileNav && navToggle) {
                mobileNav.classList.remove('open');
                navToggle.classList.remove('active');
                navToggle.setAttribute('aria-expanded', 'false');
                document.body.classList.remove('nav-open');
                // Ensure navbar stays visible after closing menu
                siteNav.classList.remove('nav-hidden');
            }
        }

        function updateCurrentLangText(lang) {
            if (langCurrentText) {
                langCurrentText.textContent = langNames[lang] || 'JP';
            }
            // Update active state on options
            langOptions.forEach(opt => {
                opt.classList.toggle('active', opt.dataset.lang === lang);
            });
        }

        if (langCurrent && langSwitcher) {
            // Toggle dropdown
            langCurrent.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = langSwitcher.classList.toggle('open');
                langCurrent.setAttribute('aria-expanded', isOpen);
                // Close nav menu when opening lang dropdown
                closeNavMenu();
            });

            // Handle language selection with debounce to prevent double-firing
            langOptions.forEach(option => {
                let lastTap = 0;
                const handleLangSelect = (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    // Debounce to prevent double-firing from touch + click
                    const now = Date.now();
                    if (now - lastTap < 300) return;
                    lastTap = now;

                    const lang = option.dataset.lang;
                    // Use window.i18n or global i18n
                    const i18nInstance = window.i18n || (typeof i18n !== 'undefined' ? i18n : null);
                    if (i18nInstance && typeof i18nInstance.switchLanguage === 'function') {
                        i18nInstance.switchLanguage(lang);
                    }
                    closeLangDropdown();
                };
                option.addEventListener('click', handleLangSelect, { passive: false });
            });
        }

        // Update current lang text on language change
        window.addEventListener('languageChanged', (e) => {
            updateCurrentLangText(e.detail?.lang || document.documentElement.lang);
        });

        // Initialize current language display
        const initLang = document.documentElement.lang || 'ja';
        updateCurrentLangText(initLang);

        // ==================== Global: Close on outside click ====================
        document.addEventListener('click', (e) => {
            // Close nav menu
            if (mobileNav && navToggle && !mobileNav.contains(e.target) && !navToggle.contains(e.target)) {
                closeNavMenu();
            }
            // Close lang dropdown
            if (langSwitcher && !langSwitcher.contains(e.target)) {
                closeLangDropdown();
            }
        });

        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeNavMenu();
                closeLangDropdown();
            }
        });
    })();
    </script>
</body>
</html>
